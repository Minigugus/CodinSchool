<!doctype html>
<html lang="fr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="icon" href="img/favicon.ico">

	<title>CodinSchool</title>

	<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
	<link href="assets/css/fontawesome-all.min.css" rel="stylesheet" />
	<link href="assets/css/datatables.min.css" rel="stylesheet" />
	<link href="assets/css/animate.min.css" rel="stylesheet" />
	<link href="assets/css/style.css" rel="stylesheet" />
</head>

<body>
	<nav class="navbar navbar-dark bg-dark flex-md-nowrap p-0 shadow">
		<a class="navbar-brand col-sm-3 col-md-2 mr-0" href="/">CodinSchool</a>
		<ul class="navbar-nav px-3 top-right">
			<li class="nav-item text-nowrap">
				<a class="nav-link" href="#refresh" role="refresh-data"><i id="refresh-icon" class='fas fa-sync-alt'></i> Rafraîchir les données</a>
			</li>
			<li class="nav-item text-nowrap">
				<a class="nav-link" href="#switch-profile" role="username">{{username}}</a>
			</li>
			<li class="nav-item text-nowrap">
				<a class="nav-link" href="#logout" role="logout">Se déconnecter</a>
			</li>
		</ul>
	</nav>

	<div class="container-fluid">
		<div class="row">
			<nav class="col-md-2 d-none d-md-block bg-light sidebar">
				<div class="sidebar-sticky">
					<ul class="nav flex-column">
						<li class="nav-item">
							<a class="nav-link active" role="switch-home" href="#switch-home">
								Liste des exercices <span class="sr-only">(current)</span>
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="/login">
								Login page (test)
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="/admin/register">
								Register page (test)
							</a>
						</li>
					</ul>
					<h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
						<span>Profil</span>
					</h6>
					
					<ul class="nav flex-column">
						<li class="nav-item">
							<a class="nav-link" href="#switch-profile">
								Mon compte (Profil ?)
							</a>
						</li>
					</ul>
					<ul class="nav flex-column">
						<li class="nav-item">
							<a class="nav-link" href="#logout">
								Se déconnecter
							</a>
						</li>
					</ul>
				</div>
			</nav>

			<div class="col-md-10" id="content">

				<div id="notificationLocation" class="col-md-12 pt-4"></div>

				<!-- Show the exercices list -->
				<section id="listExercices" style="display: block;" class="animated">
					<main class="col-md-12">
						<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
							<h1 class="h2">Exercices</h1>
						</div>
						<table id="exercices" class="table table-striped table-hover display" style="width:100%" >
							<thead>
								<tr>
									<th>#</th>
									<th>Nom</th>
									<th>Description</th>
									<th>Score</th>
									<th>Compétences débloquées</th>
									<th>Language</th>
									<th>Commencer</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td colspan="7" class="text-center">Chargement des exercices...</td>
									<td class="hidden"></td>
									<td class="hidden"></td>
									<td class="hidden"></td>
									<td class="hidden"></td>
									<td class="hidden"></td>
									<td class="hidden"></td>
								</tr>
							</tbody>
							<tfoot>
								<tr>
									<th>#</th>
									<th>Nom</th>
									<th>Description</th>
									<th>Score</th>
									<th>Compétences débloquées</th>
									<th>Language</th>
									<th>Commencer</th>
								</tr>
							</tfoot>
						</table>
					</main>
				</section>
				<!-- /listExercices -->

				<!-- Start an exercice -->
				<section id="doExercice" class="animated">
					<main class="col-md-12">
						<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
							<h1 class="h2">
								<span id="exerciceName">{{exerciceName}}</span> - <span id="exerciceLanguage">{{exerciceLanguage}}</span>
								- Compétences débloquées : <span id="exerciceSkill">{{exerciceSkill}}</span>
							</h1>
						</div>
						<p>Description : <span id="exerciceDescription">{{exerciceDescription}}</span></p>
					</main>
				</section>
				<!-- /doExercice -->

			</div>
			<!-- /content -->

		</div>
	</div>

	<script type="text/javascript" src="assets/js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="assets/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="assets/js/datatables.min.js"></script>
	<script type="text/javascript" src="assets/js/script.js"></script>
	<script>
		$(document).ready(function() {
			//Fetch all the needed data to sessionStorage
			fetchToSessionStorage()

			//Hash possible actions
			const actions = {
				'logout': logout,
				'refresh': refreshData,
				'switch-home': () => switchPage(pages.listExercices),
				'exercices': parameters => startExercice(parameters)
			}

			//Selection action from hash
			const doAction = hash => {
				const result = /(?:#)?([^\/]*)\/?(.*)/.exec(hash)
				const action = result[1],
				parameters = result[2]
				const callback = actions[action]
				callback && callback(parameters)
			}

			window.addEventListener('hashchange', () => doAction(new URL(window.location.href).hash));
			window.addEventListener('load', () => doAction(new URL(window.location.href).hash));

			loadNotification()

			//The function fetchToSessionStorage() already do these, but it's in case of a page refresh !
			//Set the username
			setUsername()
			//Set the exercices to the table
			setExercices()
		})
	</script>
</body>
</html>